---
title: "Arknights Pull Expectation Analysis / 《明日方舟》抽卡期望分析"
author: "3dr-zzZ"
date: "2025-03-01"
output:
  pdf_document:
    latex_engine: xelatex
    extra_dependencies: ["xeCJK"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

packages <- c("tidyverse", "latex2exp", "ggplot2")
lapply(packages, require, character.only = T)
```

## Introduction / 引言
This analysis investigates the pull expectation from a popular gacha game, Arknights, by (using statistical tools, performing data analysis), aiming to assist Doctors (i.e. the players) with statistical evidence to better make decisions about whether to pull or save.

本分析出于作者兴趣，旨在对《明日方舟》的抽卡期望进行较为严谨的统计学分析，以帮助各位博士（玩家）做出合理的抽卡决定、规划抽卡资源。

To be specific, this analysis will try to answer these questions:
  1. Which kind of banner is the best to get the desired operator(s).
  2. How many pulls does it take.
Being able to answer these questions gives a clear guidance on questions like "Should I use the (六星干员自选券) on the operator or should I pull it?", "How many resources should I have in hand to get the desired operator?", which are small however importance for the players.

【中文翻译】

Note that, I'm also planning to develop a simulation tool with GUI so that users not familiar with coding can also freely adjust the banner type, the number of operators (and more!), getting results for all kinds of simulations for a broader use. But right now if u can and like, feel free to play with the codes on Github to get some results interested.

【中文翻译】


## Data Preparation / 数据准备
卡池通过Python程序模拟。在'main.py'中可调整模拟次数，卡池种类，所需六星干员数量，并将结果输出到'output.csv'文件中。

目前模拟包含以下卡池：
 - **常驻标准寻访/中坚寻访**
 - **SideStory/故事集寻访**
 - **限定寻访**
 
```{r}
# load the data
data <- read.csv("output.csv")
data %>% colnames()
```


```{r cars}
# compute summary statistics row-wise for each column
summary_table <- data %>%
  summarise(across(
    where(is.numeric),
    list(
      mean = mean,
      median = median,
      # variance = var,
      p90 = ~quantile(.x, 0.9),
      max = max,
      min = min
    ),
    .names = "{.col}__{.fn}"
  )) %>%
  pivot_longer(everything(), names_to = c("col_name", "stat"), names_sep = "__") %>%
  pivot_wider(names_from = stat, values_from = value)

print(summary_table)
```

## Data Analysis / 数据分析


## Appendix: PMF of Six-Star Character / 附录：六星角色的概率质量分布
Besides, we can also use a parcial geometric distribution to model the probability of getting a six-star character in all banners. This allow as to find the true value of the parameter of interest. 
Maybe we can investigate other banners using the PMF approach as well, but it will be much more complicated than Python simulations and I am lazy. Perhaps we can give it a try in the future.

此外，在所有卡池中六星干员的出率分布也可以通过
```{r tmp}
# Initialize vectors
x <- 1:99
px <- numeric(99)  # probability of getting 6-star at each pull
fail_prob <- 1     # cumulative probability of not getting 6-star yet

# Phase 1: pulls 1 to 50
for (i in 1:50) {
  px[i] <- 0.02 * fail_prob
  fail_prob <- fail_prob * 0.98
}

# Phase 2: pulls 51 to 98, increasing by 2% each time
for (i in 51:98) {
  pity_prob <- 0.02 * (i - 49)  # 0.04, 0.06, ..., 0.98
  px[i] <- pity_prob * fail_prob
  fail_prob <- fail_prob * (1 - pity_prob)
}

# Phase 3: guaranteed at 99
px[99] <- fail_prob  # whatever remains

# Expected value
expected_value <- sum(x * px)
expected_value

# Create a data frame for plotting
df <- data.frame(
  pulls = x,
  probability = px
)

# Plot the PMF
ggplot(df, aes(x = pulls, y = probability)) +
  geom_col(fill = "steelblue") +
  labs(title = "PMF: Number of Pulls to Get 6-Star with Pity System",
       x = "Number of Pulls",
       y = "Probability") +
  theme_minimal()
```

